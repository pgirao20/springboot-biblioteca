<!-- src/main/resources/templates/admin/sanciones.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es"
      th:with="title='M贸dulo de Sanciones', active='sanciones'">
<head th:replace="fragments/_header :: head(${title})"></head>
<body>
<header th:replace="fragments/_header :: header(${active})"></header>

<main class="container-fluid mt-4" style="max-width: 1300px;">

  <ul class="nav nav-tabs mb-4">

    <li class="nav-item">
      <a class="nav-link active" th:href="@{/admin/sanciones}">Sanciones</a>
    </li>
  </ul>

  <!-- Mensajes -->
  <div th:if="${ok}" class="alert alert-success" th:text="${ok}"></div>
  <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="card-title mb-0">Listado de Sanciones</h5>
        <input type="text" id="buscadorSanciones" class="form-control w-50"
               placeholder=" Buscar por DNI, c贸digo o nombre">
      </div>

      <div class="table-responsive">
        <table class="table table-sm table-bordered align-middle" id="tabla-sanciones">
          <thead class="table-light text-center">
          <tr>
            <th>DNI</th>
            <th>C贸digo</th>
            <th>Nombres</th>
            <th>Apellidos</th>
            <th>Inicio sanci贸n</th>
            <th>Fin sanci贸n</th>
            <th>Monto (S/)</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
          </thead>
          <tbody>
          <tr th:if="${#lists.isEmpty(sanciones)}">
            <td colspan="9" class="text-center text-muted py-3">
              No hay sanciones registradas.
            </td>
          </tr>

          <tr th:each="s : ${sanciones}">
            <td th:text="${s.dni}"></td>
            <td th:text="${s.codigo}"></td>
            <td th:text="${s.nombres}"></td>
            <td th:text="${s.apellidos}"></td>
            <td th:text="${s.inicioSancion}"></td>
            <td th:text="${s.finSancion} ?: '-'"></td>
            <td th:text="${#numbers.formatDecimal(s.monto, 1, 'POINT', 2, 'POINT')}"></td>
            <td class="text-center">
              <span th:if="${s.disponiblePrestamo}"
                    class="badge bg-success">
                Pr茅stamo disponible
              </span>
              <span th:if="${!s.disponiblePrestamo}"
                    class="badge bg-danger">
                Pr茅stamo NO disponible
              </span>
            </td>
            <td class="text-center">
              <form th:action="@{/admin/sanciones/quitar}" method="post" class="d-inline">
                <input type="hidden" name="idEstudiante" th:value="${s.idEstudiante}">
                <button type="submit"
                        class="btn btn-sm btn-outline-warning"
                        th:disabled="${s.disponiblePrestamo}">
                  Quitar sanci贸n
                </button>
              </form>

              <form th:action="@{/admin/sanciones/borrar}" method="post" class="d-inline ms-1">
                <input type="hidden" name="idEstudiante" th:value="${s.idEstudiante}">
                <button type="submit"
                        class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('驴Seguro que deseas borrar la sanci贸n?');">
                  Borrar
                </button>
              </form>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>

</main>

<footer th:replace="fragments/_footer :: footer"></footer>

<script>
// Filtro simple por texto
document.addEventListener("DOMContentLoaded", () => {
  const input = document.getElementById("buscadorSanciones");
  const tabla = document.getElementById("tabla-sanciones");
  if (!input || !tabla) return;

  input.addEventListener("input", function () {
    const filtro = this.value.toLowerCase().trim();
    const filas = tabla.querySelectorAll("tbody tr");

    filas.forEach(fila => {
      // saltar la fila "No hay sanciones" si existe
      if (fila.querySelector("td[colspan]")) return;

      const texto = fila.innerText.toLowerCase();
      fila.style.display = (!filtro || texto.includes(filtro)) ? "" : "none";
    });
  });
});
</script>

</body>
</html>
