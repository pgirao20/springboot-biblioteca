<!-- src/main/resources/templates/admin/prestamos/prestamo_tablets.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es"
      th:with="title='Pr√©stamo de Tablets', active='prestamos'">
<head th:replace="fragments/_header :: head(${title})"></head>
<body>
<header th:replace="fragments/_header :: header(${active})"></header>

<main class="container-fluid mt-4" style="max-width:1500px;">
  <ul class="nav nav-tabs mb-4">
    <li class="nav-item"><a class="nav-link" th:href="@{/admin/prestamos/libros}">Pr√©stamo de Libros</a></li>
    <li class="nav-item"><a class="nav-link active" th:href="@{/admin/prestamos/tablets}">Pr√©stamo de Tablets</a></li>
  </ul>
  <!-- Mensaje de sanci√≥n -->
<div th:if="${errorSancion}" class="alert alert-danger alert-dismissible fade show" role="alert">
  <span th:text="${errorSancion}"></span>
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
  <!-- Mensajes -->
  <div th:if="${ok}" class="alert alert-success" th:text="${ok}"></div>
  <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
  <div class="row">
    
    <!-- =======================================================
         COLUMNA IZQUIERDA: NUEVO PR√âSTAMO DE TABLET
    ======================================================== -->
    <div class="col-md-5">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">Nuevo Pr√©stamo de Tablet</h5>

          <form id="form-tablets"
                th:action="@{/admin/prestamos/tablets/registrar}"
                method="post">

            <!-- ============================
                 Estudiante
            ============================= -->
            <div class="mb-3">
              <label class="form-label">Estudiante</label>
              <input list="listaEstudiantes"
                     class="form-control"
                     id="estudianteInput"
                     placeholder="Buscar por c√≥digo o nombre"
                     required>

              <div id="alertaSancionEstudianteTablets" style="display:none;" class="mt-2"></div>

              <datalist id="listaEstudiantes">
                <option th:each="e : ${estudiantes}"
                        th:value="${e.codigo + ' - ' + e.nombres + ' ' + e.apellidos}">
                </option>
              </datalist>
            </div>

            <!-- ============================
                 Tablet (input list)
            ============================= -->
            <div class="mb-3">
              <label class="form-label">Tablet (SN - Marca Modelo)</label>
              <input list="listaTablets"
                     class="form-control"
                     id="tabletInput"
                     placeholder="Seleccionar tablet por SN">

              <datalist id="listaTablets">
                <option th:each="t : ${tablets}"
                        th:value="${t.sn + ' - ' + t.marca + ' ' + t.modelo}">
                </option>
              </datalist>

              <small class="text-muted">Solo se mostrar√°n tablets disponibles.</small>
            </div>

            <!-- ============================
                 Estado inicial en la prelista
            ============================= -->
            <div class="mb-3">
              <label class="form-label">Estado inicial</label>
              <select class="form-select" id="estadoInput">
                <option th:each="es : ${estados}" th:value="${es}" th:text="${es}"></option>
              </select>
            </div>

            <!-- ============================
                 Bot√≥n agregar a prelista
            ============================= -->
            <button type="button"
                    class="btn btn-success w-100 mb-3"
                    onclick="agregarTabletPrelista()"
                    id="btnRegistrarPrestamoTablets">
              Agregar a la prelista
            </button>

            <!-- ============================
                 Tabla PRELISTA
            ============================= -->
            <div class="table-responsive mb-3">
              <table class="table table-sm table-bordered" id="tabla-prelista">
                <thead class="table-light">
                <tr>
                  <th>Tablet</th>
                  <th>Estado</th>
                  <th>Acci√≥n</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td colspan="3" class="text-center text-muted">Sin tablets agregadas</td>
                </tr>
                </tbody>
              </table>
            </div>

            <!-- ============================
                 Fechas
            ============================= -->
            <div class="mb-3">
              <label class="form-label">Fecha Pr√©stamo</label>
              <input type="date"
                     class="form-control"
                     id="fechaPrestamo"
                     name="fechaPrestamo"
                     th:attr="min=${hoy}"
                     required>
            </div>

            <div class="mb-3">
              <label class="form-label">Fecha Devoluci√≥n</label>
              <input type="date"
                     class="form-control"
                     id="fechaDevolucion"
                     name="fechaDevolucion"
                     required>
            </div>

            <!-- Hidden: c√≥digo estudiante y lista de SN -->
            <input type="hidden" id="codigoEstudiante" name="codigoEstudiante">
            <input type="hidden" id="sns" name="sns">

            <button class="btn btn-primary w-100">Confirmar Pr√©stamo</button>
            <button type="button" class="btn btn-light border w-100 mt-2" onclick="limpiarPrestamo()">
              <i class="fa-solid fa-rotate"></i> Limpiar
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- =======================================================
         COLUMNA DERECHA: PR√âSTAMOS REGISTRADOS
    ======================================================== -->
    <div class="col-md-7">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="card-title mb-0">Pr√©stamos de Tablets Registrados</h5>
            <input type="text" class="form-control w-50" id="buscadorTablets" placeholder="üîé Buscar por estudiante o tablet">
          </div>

          <div class="row g-3" id="lista-prestamos-tablets">
            <div class="col-12" th:each="p : ${prestamos}">
<div class="card shadow-sm"
     th:classappend="${p.estado == 'ACTIVO'} ? ' border-success' :
                     (${p.estado == 'VENCIDO'} ? ' border-danger' :
                     (${p.estado == 'PENDIENTE'} ? ' border-warning' : ' border-secondary'))">
                <div class="card-body d-flex justify-content-between align-items-center">

                  <div>
                    <h6 class="fw-bold mb-1"
                        th:text="'üë§ ' + ${p.estudiante} + ' (' + ${p.codigoEstudiante} + ')'"></h6>
                    <small th:text="'Tablet: ' + ${p.item}"></small><br>
                    <small th:text="'Pr√©stamo: ' + ${p.fechaPrestamo} + ' | Devoluci√≥n: ' + ${p.fechaDevolucion}"></small>
                  </div>
                    <div class="text-end">
                    <span class="badge mb-2"
                          th:classappend="${p.estado == 'ACTIVO'} ? ' bg-success' :
                                          (${p.estado == 'VENCIDO'} ? ' bg-danger' :
                                          (${p.estado == 'PENDIENTE'} ? ' bg-warning text-dark' : ' bg-secondary'))"
                          th:text="${p.estado}">
                    </span><br>
                                        <!-- <button class="btn btn-sm btn-outline-warning me-1">‚úèÔ∏è</button> -->
                    <form th:action="@{/admin/prestamos/eliminar}" method="post" class="d-inline">
                      <input type="hidden" name="codigo" th:value="${p.codigo}">
                      <input type="hidden" name="tipo" value="tablets">
                      <button type="submit"
                              class="btn btn-sm btn-outline-danger me-1"
                              onclick="return confirm('¬øSeguro que deseas eliminar este pr√©stamo?');">
                        ‚ùå
                      </button>
                    </form>

                    <!-- Bot√≥n activo solo si NO est√° devuelto -->
                    <button type="button"
                            class="btn btn-sm btn-outline-info"
                            title="Confirmar Devoluci√≥n"
                            data-bs-toggle="modal"
                            data-bs-target="#modalDevolucionTablet"
                            th:if="${p.estado != 'DEVUELTO'}"
                            th:attr="data-codigo=${p.codigo},
                                    data-estudiante=${p.estudiante},
                                    data-tablet=${p.item},
                                    data-fecha-prestamo=${p.fechaPrestamo},
                                    data-fecha-devolucion=${p.fechaDevolucion}">
                      üì•
                    </button>

                    <!-- Bot√≥n deshabilitado si ya est√° devuelto -->
                    <button type="button"
                            class="btn btn-sm btn-outline-secondary"
                            title="La tablet ya fue devuelta"
                            th:if="${p.estado == 'DEVUELTO'}"
                            disabled>
                      üì•
                    </button>
                  </div>

                </div>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>

  </div>
  <!-- MODAL DEVOLUCI√ìN TABLET -->
<div class="modal fade" id="modalDevolucionTablet" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form th:action="@{/admin/prestamos/tablets/devolver}" method="post">
        <div class="modal-header">
          <h5 class="modal-title">Confirmar Devoluci√≥n de Tablet</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"
                  aria-label="Close"></button>
        </div>

        <div class="modal-body">

          <!-- Datos pr√©stamo -->
          <div class="mb-2">
            <label class="form-label fw-semibold">Estudiante</label>
            <input type="text" class="form-control" id="devEstudianteTablet" readonly>
          </div>

          <div class="mb-2">
            <label class="form-label fw-semibold">Tablet</label>
            <input type="text" class="form-control" id="devTablet" readonly>
          </div>

          <div class="mb-2">
            <label class="form-label">Fecha Pr√©stamo / Devoluci√≥n pactada</label>
            <div class="d-flex gap-2">
              <input type="text" class="form-control" id="devFechaPrestamoTablet" readonly>
              <input type="text" class="form-control" id="devFechaDevolucionTablet" readonly>
            </div>
          </div>

          <!-- Fecha devoluci√≥n real (hoy, solo informativa) -->
          <div class="mb-2">
            <label class="form-label">Fecha de devoluci√≥n real</label>
            <input type="text" class="form-control" id="devFechaRealTablet" readonly>
          </div>

          <!-- Estado final de la tablet -->
          <div class="mb-2">
            <label class="form-label fw-semibold">Estado de la tablet al devolver</label>
            <select class="form-select" name="estadoTablet" id="estadoTablet">
              <option value="DISPONIBLE" selected>Disponible (Buen estado)</option>
              <option value="MANTENIMIENTO">Mantenimiento (requiere reparaci√≥n)</option>
              <option value="DA√ëADO">Da√±ado (p√©rdida total)</option>
            </select>
          </div>

          <!-- Valor tablet -->
          <div class="mb-2">
            <label class="form-label fw-semibold">Valor de la tablet (S/)</label>
            <input type="number" class="form-control"
                   id="valorTablet" name="valorTablet"
                   step="0.01" min="0" required>
          </div>

          <!-- Info de costo y sanci√≥n -->
          <div class="alert alert-info py-2 mb-2" id="infoCostoTablet">
            Costo por reparaci√≥n: S/ 0.00
          </div>
          <div class="alert alert-warning py-2 mb-0" id="infoSancionTablet" style="display:none;">
            El estudiante ser√° sancionado por 7 d√≠as desde hoy por devoluci√≥n tard√≠a.
          </div>

          <!-- hidden: c√≥digo pr√©stamo -->
          <input type="hidden" id="codigoPrestamoTablet" name="codigoPrestamo">

        </div>

        <div class="modal-footer">
          <button type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal">Cancelar</button>
          <button type="submit"
                  class="btn btn-primary">Confirmar Devoluci√≥n</button>
        </div>
      </form>
    </div>
  </div>
</div>

</main>

<footer th:replace="fragments/_footer :: footer"></footer>


<!-- =======================================================
     JAVASCRIPT PARA MANEJO DE PRELISTA Y FECHAS
======================================================= -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const fechaPrestamoInput   = document.getElementById('fechaPrestamo');
  const fechaDevolucionInput = document.getElementById('fechaDevolucion');
  const formTablets          = document.getElementById("form-tablets");

  if (!fechaPrestamoInput || !fechaDevolucionInput || !formTablets) {
    console.warn("No se encontraron inputs de fechas o el form de tablets.");
    return;
  }

  // Helper: YYYY-MM-DD
  const toDateString = (d) => {
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, '0');
    const dd = String(d.getDate()).padStart(2, '0');
    return `${yyyy}-${mm}-${dd}`;
  };

  // Configura min/max de fechaDevolucion a partir de la fecha de pr√©stamo
  function configurarRangoDevolucion(fechaPrestamoStr) {
    if (!fechaPrestamoStr) return;

    const fecha = new Date(fechaPrestamoStr + 'T00:00:00');

    // M√≠nimo = pr√©stamo + 1 d√≠a (ma√±ana)
    const min = new Date(fecha);
    min.setDate(min.getDate() + 1);

    // M√°ximo = pr√©stamo + 7 d√≠as
    const max = new Date(fecha);
    max.setDate(max.getDate() + 7);

    const minDev = toDateString(min);
    const maxDev = toDateString(max);

    fechaDevolucionInput.min = minDev;
    fechaDevolucionInput.max = maxDev;

    // Si el usuario ya hab√≠a elegido algo fuera de rango, lo limpiamos
    if (fechaDevolucionInput.value &&
       (fechaDevolucionInput.value < minDev || fechaDevolucionInput.value > maxDev)) {
      fechaDevolucionInput.value = "";
    }
  }

  // 1) Autollenar fecha de pr√©stamo con HOY y configurar rango de devoluci√≥n
  (function cargarFechaHoy() {
    const hoy = new Date();
    const hoyStr = toDateString(hoy);
    fechaPrestamoInput.value = hoyStr;
    configurarRangoDevolucion(hoyStr);
  })();

  // 2) Si cambia la fecha de pr√©stamo, recalcular rango de devoluci√≥n
  fechaPrestamoInput.addEventListener('change', () => {
    configurarRangoDevolucion(fechaPrestamoInput.value);
  });

  // =============================
  //   PRELISTA DE TABLETS
  // =============================

  function agregarTabletPrelista() {
    const input  = document.getElementById("tabletInput").value.trim();
    const estado = document.getElementById("estadoInput").value;
    const tbody  = document.querySelector("#tabla-prelista tbody");

    if (!input || !input.includes(" - ")) {
      alert("Selecciona una tablet v√°lida de la lista.");
      return;
    }

    const partes = input.split(" - ");
    const sn     = partes[0];
    const modelo = partes.slice(1).join(" - ");

    // borrar fila "Sin tablets agregadas"
    if (tbody.rows.length === 1 && tbody.rows[0].cells.length === 1) {
      tbody.innerHTML = "";
    }

    // evitar duplicados
    for (const fila of tbody.rows) {
      if (fila.cells[0].innerText.startsWith(sn)) {
        alert("Esta tablet ya est√° en la prelista.");
        return;
      }
    }

    const fila = tbody.insertRow();
    fila.innerHTML = `
      <td>${sn} - ${modelo}</td>
      <td>${estado}</td>
      <td>
        <button type="button" class="btn btn-sm btn-warning me-1" onclick="editarFilaTablet(this)">Editar</button>
        <button type="button" class="btn btn-sm btn-danger" onclick="this.closest('tr').remove()">Quitar</button>
      </td>
    `;

    document.getElementById("tabletInput").value = "";
  }

  function editarFilaTablet(btn) {
    const fila   = btn.closest("tr");
    const valor  = fila.cells[0].innerText;
    const estado = fila.cells[1].innerText;

    document.getElementById("tabletInput").value = valor;
    document.getElementById("estadoInput").value = estado;

    fila.remove();
  }

  // Exponer funciones al scope global para los onclick del HTML
  window.agregarTabletPrelista = agregarTabletPrelista;
  window.editarFilaTablet      = editarFilaTablet;

  // =============================
  //   SUBMIT FORM TABLETS
  // =============================
  formTablets.addEventListener("submit", function(e) {
    const tbody = document.querySelector("#tabla-prelista tbody");

    if (tbody.rows.length === 0 ||
       (tbody.rows.length === 1 && tbody.rows[0].cells.length === 1)) {
      e.preventDefault();
      alert("Debes agregar al menos una tablet a la prelista.");
      return;
    }

    // Estudiante: extraer c√≥digo (antes de " - ")
    const estStr = document.getElementById("estudianteInput").value.trim();
    if (!estStr.includes(" - ")) {
      e.preventDefault();
      alert("Selecciona un estudiante v√°lido de la lista.");
      return;
    }
    const codEst = estStr.split(" - ")[0].trim();
    document.getElementById("codigoEstudiante").value = codEst;

    // Armar lista de SNs desde la prelista
    const sns = [];
    for (const fila of tbody.rows) {
      const texto = fila.cells[0].innerText; // "SNXXX - Marca Modelo"
      const sn    = texto.split(" - ")[0].trim();
      sns.push(sn);
    }
    document.getElementById("sns").value = sns.join(",");

    // Validaci√≥n de fechas
    const fp     = fechaPrestamoInput.value;
    const fd     = fechaDevolucionInput.value;
    const minDev = fechaDevolucionInput.min;
    const maxDev = fechaDevolucionInput.max;

    if (!fp || !fd) {
      e.preventDefault();
      alert("Debes seleccionar ambas fechas.");
      return;
    }

    if (fd < minDev || fd > maxDev) {
      e.preventDefault();
      alert("La fecha de devoluci√≥n debe ser entre 1 y 7 d√≠as despu√©s de la fecha de pr√©stamo.");
      return;
    }
  });

    // ==================================================
  //   VERIFICAR SANCI√ìN AL ELEGIR ESTUDIANTE (AJAX)
  // ==================================================
  const estudianteInput = document.getElementById("estudianteInput");
  const alertaTablets = document.getElementById("alertaSancionEstudianteTablets");
  const btnRegistrarTablets = document.getElementById("btnRegistrarPrestamoTablets");

  if (alertaTablets) {
    alertaTablets.style.display = "none";
  }

  function obtenerCodigoDesdeInputTablets() {
    if (!estudianteInput) return null;
    const valor = estudianteInput.value.trim();
    if (!valor || !valor.includes(" - ")) return null;
    return valor.split(" - ")[0].trim();
  }

  async function verificarSancionTablets() {
    const codigo = obtenerCodigoDesdeInputTablets();
    if (!codigo) {
      if (alertaTablets) alertaTablets.style.display = "none";
      if (btnRegistrarTablets) btnRegistrarTablets.disabled = false;
      return;
    }

    try {
      const res = await fetch(`/admin/estudiantes/sancion/${encodeURIComponent(codigo)}`);
      if (!res.ok) {
        console.error("Error HTTP:", res.status);
        return;
      }

      const data = await res.json();

      // Estudiante no existe
      if (!data.existe) {
        if (alertaTablets) {
          alertaTablets.className = "mt-2 alert alert-warning";
          alertaTablets.textContent = "Estudiante no encontrado.";
          alertaTablets.style.display = "block";
        }
        if (btnRegistrarTablets) btnRegistrarTablets.disabled = true;
        return;
      }

      // Estudiante sancionado
      if (data.sancionado) {
        if (alertaTablets) {
          alertaTablets.className = "mt-2 alert alert-danger";
          alertaTablets.textContent =
            `Estudiante sancionado hasta ${data.sancionadoHasta}. No puede realizar pr√©stamos de tablets.`;
          alertaTablets.style.display = "block";
        }
        if (btnRegistrarTablets) btnRegistrarTablets.disabled = true;
      } else {
        // Estudiante OK
        if (alertaTablets) {
          alertaTablets.style.display = "none";
        }
        if (btnRegistrarTablets) btnRegistrarTablets.disabled = false;
      }

    } catch (err) {
      console.error("Error al verificar sanci√≥n (tablets):", err);
    }
  }

  if (estudianteInput) {
    estudianteInput.addEventListener("change", verificarSancionTablets);
    estudianteInput.addEventListener("blur", verificarSancionTablets);
  }


// ============================
  //   MODAL DEVOLUCI√ìN TABLET
  // ============================
  const modalDevolucionTablet = document.getElementById('modalDevolucionTablet');

  if (modalDevolucionTablet) {

    modalDevolucionTablet.addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      if (!button) return;

      const codigo       = button.getAttribute('data-codigo');
      const estudiante   = button.getAttribute('data-estudiante');
      const tablet       = button.getAttribute('data-tablet');
      const fPrestamo    = button.getAttribute('data-fecha-prestamo');
      const fDevolucion  = button.getAttribute('data-fecha-devolucion');

      // Llenar campos del modal
      document.getElementById('codigoPrestamoTablet').value     = codigo;
      document.getElementById('devEstudianteTablet').value      = estudiante;
      document.getElementById('devTablet').value                = tablet;
      document.getElementById('devFechaPrestamoTablet').value   = fPrestamo;
      document.getElementById('devFechaDevolucionTablet').value = fDevolucion;

      // Fecha real = hoy
      const hoy   = new Date();
      const yyyy  = hoy.getFullYear();
      const mm    = String(hoy.getMonth() + 1).padStart(2, '0');
      const dd    = String(hoy.getDate()).padStart(2, '0');
      const hoyStr = `${yyyy}-${mm}-${dd}`;
      document.getElementById('devFechaRealTablet').value = hoyStr;

      // Evaluar sanci√≥n (hoy > fechaDevolucion pactada)
      const infoSancionTablet = document.getElementById('infoSancionTablet');
      if (fDevolucion && hoyStr > fDevolucion) {
        infoSancionTablet.style.display = 'block';
      } else {
        infoSancionTablet.style.display = 'none';
      }

      // Reset estado / valor / costo
      selectEstadoTablet.value = 'DISPONIBLE';
      manejarEstadoTablet();
    });

    const inputValorTablet   = document.getElementById('valorTablet');
    const selectEstadoTablet = document.getElementById('estadoTablet');
    const infoCostoTablet    = document.getElementById('infoCostoTablet');

    function recalcularCostoTablet() {
      const val = parseFloat(inputValorTablet.value || '0');
      const est = selectEstadoTablet.value;

      let costo = 0;
      if (est === 'MANTENIMIENTO') {
        costo = val * 0.5;
      } else if (est === 'DA√ëADO') {
        costo = val;
      } else {
        costo = 0;
      }
      infoCostoTablet.innerText = 'Costo por reparaci√≥n: S/ ' + costo.toFixed(2);
    }

    function manejarEstadoTablet() {
      const est = selectEstadoTablet.value;

      if (est === 'MANTENIMIENTO' || est === 'DA√ëADO') {
        // El usuario debe ingresar el valor real de la tablet
        inputValorTablet.readOnly = false;
        inputValorTablet.value = '';
      } else {
        // DISPONIBLE (buen estado): se env√≠a 0 autom√°ticamente
        inputValorTablet.readOnly = true;
        inputValorTablet.value = '0';
      }

      recalcularCostoTablet();
    }

    inputValorTablet.addEventListener('input', recalcularCostoTablet);
    selectEstadoTablet.addEventListener('change', manejarEstadoTablet);
  }

});
</script>

<script>
function limpiarPrestamo() {
  // Limpiar estudiante
  document.getElementById("estudianteInput").value = "";
  document.getElementById("codigoEstudiante").value = "";

  // Limpiar fechas
  const fechaPrestamoInput = document.getElementById("fechaPrestamo");
  const fechaDevolucionInput = document.getElementById("fechaDevolucion");

  // Fecha hoy
  const hoy = new Date();
  const yyyy = hoy.getFullYear();
  const mm = String(hoy.getMonth() + 1).padStart(2, '0');
  const dd = String(hoy.getDate()).padStart(2, '0');
  const hoyStr = `${yyyy}-${mm}-${dd}`;

  // Restaurar fecha pr√©stamo a hoy
  fechaPrestamoInput.value = hoyStr;
  // Disparar evento para actualizar min/max de devoluci√≥n
  fechaPrestamoInput.dispatchEvent(new Event("change"));
  // Limpiar fecha de devoluci√≥n
  fechaDevolucionInput.value = "";

  // Limpiar SNs ocultos
  document.getElementById("sns").value = "";

  // Limpiar tabla prelista
  const tbody = document.querySelector("#tabla-prelista tbody");
  tbody.innerHTML = `
      <tr>
        <td colspan="3" class="text-center text-muted py-3">
          Sin tablets agregadas
        </td>
      </tr>
  `;

  // Restaurar estado por defecto si existe
  const estadoInput = document.getElementById("estadoInput");
  if (estadoInput) estadoInput.value = estadoInput.options[0].value;

  // Opcional: alerta si tienes SweetAlert2 cargado
  if (typeof Swal !== "undefined") {
    Swal.fire({
      icon: 'info',
      title: 'Formulario Restablecido',
      text: 'El pr√©stamo ha sido cancelado y el formulario se limpi√≥.',
      timer: 1200,
      showConfirmButton: false
    });
  }
}
</script>

<script>
// Filtro por c√≥digo de estudiante o SN de tablet (o cualquier texto en la tarjeta)
const inputBuscador = document.getElementById("buscadorTablets");
const contenedorTarjetas = document.getElementById("lista-prestamos-tablets");

if (inputBuscador && contenedorTarjetas) {
  inputBuscador.addEventListener("input", function () {
    const filtro = this.value.toLowerCase().trim();
    const columnas = contenedorTarjetas.querySelectorAll(".col-12");

    columnas.forEach(col => {
      const texto = col.innerText.toLowerCase();
      // Si el filtro est√° vac√≠o o el texto de la tarjeta contiene el filtro ‚Üí mostrar
      if (!filtro || texto.includes(filtro)) {
        col.style.display = "";
      } else {
        col.style.display = "none";
      }
    });
  });
}
</script>

</body>
</html>
